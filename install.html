<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Install</title>
  <script src="https://api.bitrix24.com/api/v1/"></script>
</head>
<body>
  <div style="font-family: Arial; padding: 12px;">Installing...</div>

  <script>
    (function () {
      function getAppBaseUrl() {
        // install.html qayerda turgan bo‘lsa, o‘sha bazaga index.html ni ulaymiz
        const url = new URL(window.location.href);
        url.pathname = url.pathname.replace(/\/[^\/]*$/, "/");
        return url.toString();
      }

      BX24.init(function () {
        const base = getAppBaseUrl();
        const handler = base + "index.html";

        BX24.callMethod(
          "placement.bind",
          {
            PLACEMENT: "CRM_DEAL_DETAIL_TAB",
            HANDLER: handler,
            TITLE: "MUDDATLI TO'LOV"
          },
          function (res) {
            if (res.error()) {
              document.body.innerHTML =
                "<pre style='color:#b00'>placement.bind error: " +
                res.error() + " — " + (res.error_description() || "") + "</pre>";
              return;
            }
            BX24.installFinish();
          }
        );
      });
    })();
  </script>
</body>
</html>
