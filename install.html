<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Install - Muddatli To'lov</title>
  <script src="https://api.bitrix24.com/api/v1/"></script>
  <style>
    body{font-family:Arial,sans-serif;padding:14px}
    pre{background:#f6f7f9;border:1px solid #e6e8ee;padding:12px;border-radius:10px;white-space:pre-wrap}
  </style>
</head>
<body>
  <h3>Installingâ€¦</h3>
  <div id="out"></div>

<script>
(function(){
  function log(msg){
    document.getElementById("out").innerHTML += "<pre>"+String(msg)+"</pre>";
  }

  BX24.init(function(){
    const base = new URL(window.location.href);
    base.pathname = base.pathname.replace(/\/[^\/]*$/, "/");

    const dealHandler  = base.toString() + "deal.html";
    const adminHandler = base.toString() + "admin.html";

    // 1) Deal kartasida TAB
    BX24.callMethod("placement.bind", {
      PLACEMENT: "CRM_DEAL_DETAIL_TAB",
      HANDLER: dealHandler,
      TITLE: "MUDDATLI TO'LOV"
    }, function(res){
      if (res.error()){
        log("CRM_DEAL_DETAIL_TAB bind error:\n" + res.error() + "\n" + (res.error_description()||""));
      } else {
        log("CRM_DEAL_DETAIL_TAB bound OK:\n" + dealHandler);
      }

      // 2) Chap menyu (Admin panel)
      BX24.callMethod("placement.bind", {
        PLACEMENT: "LEFT_MENU",
        HANDLER: adminHandler,
        TITLE: "Muddatli to'lov (Settings)"
      }, function(res2){
        if (res2.error()){
          log("LEFT_MENU bind error:\n" + res2.error() + "\n" + (res2.error_description()||""));
        } else {
          log("LEFT_MENU bound OK:\n" + adminHandler);
        }

        BX24.installFinish();
      });
    });
  });
})();
</script>
</body>
</html>
